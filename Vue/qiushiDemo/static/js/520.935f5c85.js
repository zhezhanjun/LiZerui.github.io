"use strict";(self["webpackChunkdemo03"]=self["webpackChunkdemo03"]||[]).push([[520],{3520:function(t,e,i){i.r(e),i.d(e,{default:function(){return h}});var s=function(){var t=this,e=t._self._c;return t.contentData.length>0?e("div",{ref:"videoInsideView",staticClass:"video-inside-view"},[e("div",{ref:"contentWrap",staticClass:"content-wrap"},t._l(t.contentData,(function(i,s){return e("div",{key:i.id,ref:"contentBox",refInFor:!0,staticClass:"content-box"},[e("div",[e("div",{staticClass:"bg",on:{touchstart:function(e){return e.target!==e.currentTarget?null:t.showMenu(i,s,e)},touchend:function(e){return t.videoChangeEnd(s,e)}}},[t._v(" > "),i.isShowMenu?e("div",{staticClass:"bg-bottom"}):t._e()]),e("div",{staticClass:"top-nav"},[e("div",{staticClass:"goback-icon",on:{click:t.goBack}},[e("van-icon",{attrs:{name:"arrow-left"}})],1),e("div",{staticClass:"user-msg"},[e("div",{staticClass:"imgbox"},[e("img",{staticClass:"auto-img",attrs:{src:i.user.thumb,alt:""}})]),e("div",{staticClass:"textbox"},[e("div",{staticClass:"top"},[t._v(t._s(i.user.login))]),e("div",{staticClass:"bottom"},[t._v(" "+t._s(i.loop>1e4?`${Math.floor(i.loop/1e4)}+万`:i.loop)+" 次播放 ")])])]),e("div",{staticClass:"follow-icon",on:{click:function(e){return t.toFollow(i)}}},[t._v(" "+t._s(1==i.isFollow?"已关注":"关注")+" ")])]),"video"==i.format?e("div",{staticClass:"video-box"},[e("video",{ref:"video",refInFor:!0,attrs:{muted:"",src:i.high_url,autoplay:""},domProps:{muted:!0},on:{canplay:function(e){return t.videoPlayHandel(i,s)},timeupdate:function(e){return t.videoPlayingHandel(i,s)}}})]):t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:i.isShowMenu,expression:"item.isShowMenu"}],staticClass:"bottom-menu"},[e("div",{staticClass:"title"},[t._v(t._s(i.content))]),e("div",{staticClass:"bottom-icon"},[e("div",{staticClass:"bottom-icon-left"},[e("div",{staticClass:"icon like",class:{likeActive:i.isLike},on:{click:function(e){return t.toLike(i)}}},[e("div",{staticClass:"like-count"},[t._v(t._s(i.votes.up))])]),e("div",{staticClass:"icon dislike",class:{dislikeActive:i.isDislike},on:{click:function(e){return t.toDislike(i)}}})]),e("div",{staticClass:"bottom-icon-right"},[e("div",{staticClass:"icon comment",on:{click:function(e){return t.goToComment(i)}}},[e("div",{staticClass:"comment-count"},[t._v(" "+t._s(i.comments_count>0?i.comments_count:"评论")+" ")])]),e("div",{staticClass:"icon share",on:{click:function(e){t.showShare=!0,t.shareHandel(i)}}},[e("div",{staticClass:"share-count"},[t._v(" "+t._s(i.share_count>0?i.share_count:"分享")+" ")])])])]),e("div",{staticClass:"play-control"},[e("div",{staticClass:"play-btn",on:{click:function(e){return t.playAndPause(i,s)}}},[e("van-icon",{attrs:{name:1==i.isPlay?"pause":"play"}})],1),e("div",{staticClass:"current-time"},[t._v(t._s(i.currentTime))]),e("div",{ref:"progress",refInFor:!0,staticClass:"progress"},[e("div",{staticClass:"layer",on:{click:function(e){return e.stopPropagation(),t.changeTime(i,s,e)},touchmove:function(e){return t.dragToChangeTimeData(i,s,e)},touchend:function(e){return t.dragToChangeTime(i,s,e)}}}),e("div",{staticClass:"progress-btn",style:{left:i.left-4+"%"}}),e("div",{staticClass:"progress-bar",style:{width:i.left+"%"}})]),e("div",{staticClass:"total-time"},[t._v(t._s(i.totalTime))])])]),e("van-share-sheet",{attrs:{title:"立即分享给好友",options:t.options},on:{select:t.onSelect},model:{value:t.showShare,callback:function(e){t.showShare=e},expression:"showShare"}})],1)])})),0)]):t._e()},o=[],a=(i(8146),i(8848)),n=(i(7658),i(541),i(6369)),r={setup(){const t=(0,n.iH)(!1),e=[{name:"微信",icon:"wechat"},{name:"微博",icon:"weibo"},{name:"复制链接",icon:"link"},{name:"分享海报",icon:"poster"},{name:"二维码",icon:"qrcode"}],i=e=>{(0,a.Z)(e.name),t.value=!1};return{options:e,onSelect:i,showShare:t}},name:"VideoInside",data(){return{contentData:[],videoChangeY:0,videoChangeTotalHeight:0,loading:!0,activeIndex:0,timer:null}},watch:{},created(){},activated(){this.contentData=JSON.parse(window.localStorage.getItem("VideoContentData")),this.$forceUpdate(),this.activeIndex=this.$route.params.index,this.timer=setTimeout((()=>{this.videoChangeTotalHeight=this.$refs.contentBox[0].clientHeight*this.activeIndex,this.$refs.contentWrap.style.transition="none",this.$refs.contentWrap.style.transform=`translateY(-${this.videoChangeTotalHeight}px)`,this.$refs.video[this.activeIndex].play(),this.videoPlayHandel(this.contentData[this.activeIndex],this.activeIndex),this.timer=null,this.timer=setTimeout((()=>{this.getFollowedData(),this.timer=null}),100)}),100)},methods:{toFollow(t){let e=window.localStorage.getItem("token");if(e){t.isFollow=!t.isFollow;let e=JSON.parse(window.localStorage.getItem("followedData")),i=[];e.forEach((t=>{i.push(t.id)})),t.isFollow&&-1==i.indexOf(t.user.id)?(e.push(t.user),window.localStorage.setItem("followedData",JSON.stringify(e))):e.forEach(((i,s)=>{i.id==t.user.id&&(e.splice(s,1),window.localStorage.setItem("followedData",JSON.stringify(e)))}))}else this.$router.push({name:"beforeLogin"});window.localStorage.setItem("VideoContentData",JSON.stringify(this.contentData))},toLike(t){t.isLike=!t.isLike,t.isLike?(t.isDislike=!1,t.votes.up++):t.votes.up--,window.localStorage.setItem("VideoContentData",JSON.stringify(this.contentData))},toDislike(t){t.isDislike=!t.isDislike,t.isDislike&&t.isLike&&(t.isLike=!1,t.votes.up--),window.localStorage.setItem("VideoContentData",JSON.stringify(this.contentData))},shareHandel(t){t.share_count++,window.localStorage.setItem("VideoContentData",JSON.stringify(this.contentData))},goBack(){this.$router.go(-1)},goToComment(t){window.localStorage.setItem("commentContentData",JSON.stringify(t));let e=t.id;125654473!=e&&125657703!=e&&(e=125654473),this.$router.push(`/comment?id=${e}`)},videoPlayHandel(t,e){let i=Math.floor(this.$refs.video[e].duration/60);i=i>=10?i:"0"+i;let s=Math.floor(this.$refs.video[e].duration%60);s=s>=10?s:"0"+s,t.totalTime=`${i}:${s}`,t.isPlay=!0,t.currentTime="00:00",t["isShowMenu"]=!1,this.$forceUpdate()},videoPlayingHandel(t,e){let i=Math.floor(this.$refs.video[e].currentTime/60);i=i>=10?i:"0"+i;let s=Math.floor(this.$refs.video[e].currentTime%60);s=s>=10?s:"0"+s,t.currentTime=`${i}:${s}`,t.left=this.$refs.video[e].currentTime/this.$refs.video[e].duration*100,t.currentTime==t.totalTime&&(t.isPlay=!1,this.$forceUpdate()),this.$forceUpdate()},showMenu(t,e,i){t.isShowMenu=!t.isShowMenu,this.videoChangeY=i.changedTouches[0].pageY,this.addHistoryData(e),this.$forceUpdate()},playAndPause(t,e){t.isPlay=!t.isPlay,this.$forceUpdate(),t.isPlay?this.$refs.video[e].play():t.isPlay||this.$refs.video[e].pause()},changeTime(t,e,i){this.$refs.video[e].currentTime=i.offsetX/this.$refs.progress[e].clientWidth*this.$refs.video[e].duration,t.isPlay=!0,this.$refs.video[e].play(),this.$forceUpdate()},dragToChangeTimeData(t,e,i){t.currentTime==t.totalTime&&(t.currentTime=t.totalTime),t.isPlay=!1,this.$refs.video[e].pause();let s=this.$refs.video[e].duration,o=i.changedTouches[0].pageX-95,a=this.$refs.progress[e].clientWidth;o=o>a?a:o<0?0:o;let n=o/a,r=100*n;r=r<0?0:r>100?100:r,t.left=r;let l=Math.floor(Math.floor(n*s)/60);l=l>=10?l:"0"+l;let c=Math.floor(n*s)%60;c=c>=10?c:"0"+c,t.currentTime=`${l}:${c}`,t.isPlay=!0,this.$forceUpdate()},dragToChangeTime(t,e,i){let s=(i.changedTouches[0].pageX-95)/this.$refs.progress[e].clientWidth;this.$refs.video[e].currentTime=s*this.$refs.video[e].duration,t.isPlay=!0,this.$refs.video[e].play(),this.$forceUpdate()},videoChangeEnd(t,e){if(this.addHistoryData(t),this.$refs.contentWrap.style.transition="all linear 0.5s",e.changedTouches[0].pageY<this.videoChangeY&&this.videoChangeY-e.changedTouches[0].pageY>=50){if(this.contentData.length-1==t)return void this.$toast("没有更多了哦~");this.videoChangeTotalHeight+=this.$refs.contentBox[t].clientHeight,this.$refs.contentWrap.style.transform=`translateY(-${this.videoChangeTotalHeight}px)`,this.activeIndex++,this.$refs.video[this.activeIndex].play(),this.videoPlayHandel(this.contentData[this.activeIndex],this.activeIndex)}if(e.changedTouches[0].pageY>this.videoChangeY&&e.changedTouches[0].pageY-this.videoChangeY>=50){if(0==t)return void this.$toast("没有更多了哦~");this.videoChangeTotalHeight-=this.$refs.contentBox[t].clientHeight,this.$refs.contentWrap.style.transform=`translateY(-${this.videoChangeTotalHeight}px)`,this.activeIndex--,this.$refs.video[this.activeIndex].play(),this.videoPlayHandel(this.contentData[this.activeIndex],this.activeIndex)}},getFollowedData(){let t=JSON.parse(window.localStorage.getItem("followedData")),e=[];t.forEach((t=>{e.push(t.id)})),this.contentData.forEach((t=>{-1!=e.indexOf(t.user.id)?t.isFollow=!0:t.isFollow=!1}))},addHistoryData(t){let e=JSON.parse(window.localStorage.getItem("historyData"));if(e){let i=[];e.forEach((t=>{-1==i.indexOf(t.id)&&i.push(t.id)})),-1==i.indexOf(this.contentData[t].id)&&(e.unshift(this.contentData[t]),window.localStorage.setItem("historyData",JSON.stringify(e)))}else{let e=[];e.unshift(this.contentData[t]),window.localStorage.setItem("historyData",JSON.stringify(e))}}}},l=r,c=i(1001),d=(0,c.Z)(l,s,o,!1,null,"6cf47797",null),h=d.exports}}]);
//# sourceMappingURL=520.935f5c85.js.map